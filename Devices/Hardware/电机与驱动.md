# 直流电机

## A4950

### 1. 简要介绍

* 需要2个PWM引脚才能控制正反转，所以控制2个电机需要4PWM引脚，会使用STM32F103芯片一个定时器的全部PWM通道。
* A4950模块是靠输入2路的[PWM](https://so.csdn.net/so/search?q=PWM&spm=1001.2101.3001.7020)占空比的差值，来设定输出电压的大小，当差值为0时输出为0，反之当占空比差值为100时输出最大。
* 峰值输出电流可达±3.5 A，工作电压为7.6~40v。
* 驱动频率范围：500Hz~30KHz
* 减速比-----1:28
  * **减速比为1:28通俗地讲就是当电机外伸轴转1圈时实际轴转28圈，外伸轴我们一般接上轮胎等实际作用物体，而实际轴是电机自身的转子，霍尔编码器的检测对象是实际轴**
  * **除以28即可**


### 2. 接线

![db7dacd3e49e487da68d75aa1227c0b0.png](https://i-blog.csdnimg.cn/blog_migrate/3bf816aed6a97c794fbc040488be1eb8.png)

| 引脚名称 | 输入\输出 | 接线      | 功能               |
| -------- | --------- | --------- | ------------------ |
| AOUT1    | 输出      | 接A电机正 | 输出电压控制电机   |
| AOUT2    | 输出      | 接A电机负 | 输出电压控制电机   |
| BOUT1    | 输出      | 接B电机正 | 输出电压控制电机   |
| BOUT2    | 输出      | 接B电机负 | 输出电压控制电机   |
| AIN1     | 输入      | 接STM32   | 控制电机输出电压   |
| AIN2     | 输入      | 接STM32   | 控制电机输出电压   |
| BIN1     | 输入      | 接STM32   | 控制电机输出电压   |
| BIN2     | 输入      | 接STM32   | 控制电机输出电压   |
| VM       | 输入      | 接12V电源 | 总电源             |
| VCC      | 输入      | 接5V电源  | 给内部逻辑电路供电 |
| GND      | 输出      | 接电源地  | 接地               |

### 3. 速度

单位时间的个数,得到速度

有两种方法:

#### 3-1 M测速法

1. 倍频

​	去到tim.c

![image-20251013163658205](控制.assets/image-20251013163658205.png)

```c
/** @defgroup TIM_Encoder_Mode TIM Encoder Mode
  * @{
  */
#define TIM_ENCODERMODE_TI1                      TIM_SMCR_SMS_0                                                      /*!< Quadrature encoder mode 1, x2 mode, counts up/down on TI1FP1 edge depending on TI2FP2 level  */
#define TIM_ENCODERMODE_TI2                      TIM_SMCR_SMS_1                                                      /*!< Quadrature encoder mode 2, x2 mode, counts up/down on TI2FP2 edge depending on TI1FP1 level. */
#define TIM_ENCODERMODE_TI12                     (TIM_SMCR_SMS_1 | TIM_SMCR_SMS_0)                                   /*!< Quadrature encoder mode 3, x4 mode, counts up/down on both TI1FP1 and TI2FP2 edges depending on the level of the other input. */
/**
  * @}
  */
```

**这里一般都是编码器模式3,也就是4倍频,准确性最高**

2. M 法测速公式

![image-20251013163857808](控制.assets/image-20251013163857808.png)

3. 注意事项

实际使用时对转速有限制，**如果转速太快可能发生定时器溢出**的情况，就要考虑使用中断

目前对脉冲**一次定时仅能计32768次**(65535的一半,毕竟有正反)，超过即无效，可以分别正反转。

定时器在编码器模式下电机如果正转计数器会从零开始正数，==**如果反转计数器会从重载值开始倒数**==








### 4. PID控速

* P , I , D 控制

### 5. 程序逻辑



参考文章
编码器：https://blog.csdn.net/weixin_51002159/article/details/132471463?fromshare=blogdetail&sharetype=blogdetail&sharerId=132471463&sharerefer=PC&sharesource=m0_55413155&sharefrom=from_link
电机驱动：https://easyboard.blog.csdn.net/article/details/145249656?fromshare=blogdetail&sharetype=blogdetail&sharerId=145249656&sharerefer=PC&sharesource=m0_55413155&sharefrom=from_link
VOFA:https://blog.csdn.net/AbaAbaxxx_/article/details/142136202?fromshare=blogdetail&sharetype=blogdetail&sharerId=142136202&sharerefer=PC&sharesource=m0_55413155&sharefrom=from_link
